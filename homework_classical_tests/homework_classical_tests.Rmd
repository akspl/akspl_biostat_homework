---
title: "Проверка гипотез. Классические статистические тесты"
author: "Jelena Čuklina & Maria Chernigovskaya & Alexey Glazkov & Oksana Plastinina"
date: "Октябрь 2025"
output:
  html_document:
    self_contained: true
    code_folding: hide
    code_download: false
    number_sections: false
    toc: true
    toc_float: true
    toc_title: Оглавление
    fig_align: center
    dev: png
---

ИЗМЕНЕНИЯ внесены в главы 3.1, 4.5, 5.1, 5.5, 8.1. Главы с изменения также отмечены в названия как '+ ИЗМЕНЕНИЯ'

# Настройка

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
# Установка seed для воспроизводимости
set.seed(42)
```

```{r load-packages}
library(dplyr)
library(ggplot2)
library(epitools)
# Предполагаем, что используется пакет NHANES для получения набора данных
library(NHANES)

library(tidyverse)
library(patchwork)
library(flextable)
library(ggmosaic)
```

В этом упражнении мы будем использовать набор данных NHANES (Национальное обследование здоровья и питания), который доступен через пакет NHANES. Эти данные содержат информацию о здоровье и питании населения США и широко используются для статистического анализа в области здравоохранения.

Подробное описание данных можно найти тут: https://cran.r-project.org/web/packages/NHANES/NHANES.pdf

```{r load-data}
# Загрузка набора данных NHANES (из пакета NHANES)
data(NHANES)
```

```{r}
#задаем тему для всех графиков в документе
thememine <- theme(
  plot.title = element_text(size = 15, hjust = 0.5),
  axis.title = element_text(size = 12),
  axis.text = element_text(size = 9, colour = 'grey10'),
  panel.background = element_rect(fill = 'white'),
  panel.grid = element_line(colour = 'grey90')
)

theme_set(thememine)
```


# Подготовка чистого набора данных для анализа

```{r prepare-data}
# Фокус на ключевых переменных для упражнения
nhanes_clean <- NHANES %>%
  select(Gender, Age, BMI, Diabetes, BPSysAve, BPDiaAve, PhysActive, SleepTrouble, Height, Weight, Education, HHIncome) %>%
  # Удаление строк с отсутствующими данными для упрощения в этих упражнениях
  na.omit() %>%
  # Фильтрация для возраста >= 18 для исследований взрослых
  filter(Age >= 18)

# Проверка структуры данных для студентов
cat("Структура чистого набора данных NHANES (взрослые, >=18 лет):\n")
str(nhanes_clean)

cat("\nБазовые статистики чистого набора данных NHANES (взрослые, >=18 лет):\n")
summary(nhanes_clean)
```

Дополнительно из данных уберем клинически недостоверные значения переменных BPSysAve и BPDiaAve (Нормы САД 90-129 мм рт. ст. и ДАД: 60-80 мм рт. ст. взяты из лекции). Значения вне этих диапазонов критические и в рамках нашего исследования скорее невозможные, т.к. база данных позиционируется как наблюдения пациентов при стандартных осмотрах. Критические значения ИМТ больше 40 и меньше 16 посчитали возможными.

```{r fig.height=5, fig.width=10}
BPDiaAvehist <- nhanes_clean %>% 
  ggplot()+
  geom_histogram(aes(x = BPDiaAve), fill = 'seagreen', colour = 'black')+
  labs(
    x = 'Значения среднего диастолического давления',
    y = 'Количество пациентов'
  )+
  scale_x_continuous(breaks=seq(0,120,10))+
  scale_y_continuous(breaks=seq(0,1000,100))

BPSysAvehist <- nhanes_clean %>% 
  ggplot()+
  geom_histogram(aes(x = BPSysAve), fill = 'sienna3', colour = 'black')+
  labs(
    x = 'Значения среднего систолического давления',
    y = NULL
  )+
  scale_x_continuous(breaks=seq(70,230,10))+
  scale_y_continuous(breaks=seq(0,1000,100))+
  theme(
     axis.text.y = element_blank()
  )



(BPDiaAvehist|BPSysAvehist)+
    plot_annotation(
    title = "Распределение значений среднего диастолического и систолического давления (до чистки данных)",
    theme = theme(plot.title = element_text(hjust = 0.5, size = 15)))
```

```{r}
nhanes_clean %>% 
  ggplot()+
  geom_histogram(aes(x = BMI), fill = 'skyblue1', colour = 'black')+
  labs(
    title = 'Распределение значений ИМТ (до чистки данных)',
    x = 'Значения ИМТ',
    y = 'Количество пациентов'
  )+
  scale_x_continuous(breaks = seq(10, 85, 5))+
  scale_y_continuous(breaks = seq(0, 1500, 100))
```


```{r}
#База данных для проведения анализа
nhanes_clean_mine <- nhanes_clean %>% 
  mutate(
    dif = BPSysAve - BPDiaAve
    ) %>% 
  filter((BPSysAve > 90 & BPSysAve < 129) & (BPDiaAve>60 & BPDiaAve<80)) %>% 
  mutate(
    id = row_number()
  )

summary(nhanes_clean_mine)
```
Значения разницы САД и ДАД в некоторых случаях критические, но восприняты возможными.

Наша выборка сокращается примерно на половину (до 3116), но остается достаточно большой и соответсвенно репрезентативной. 

------------------------------------------------------------------------

# Тесты для непрерывных данных

## Параметрические тесты

### 1: сравнение ИМТ с историческим средним

На основе исторических данных среднее значение ИМТ (BMI) для взрослых в США составляет **28.5**. ИМТ (индекс массы тела) рассчитывается как масса в килограммах, делённая на квадрат роста в метрах: BMI = weight (kg) / height (m)\^2. Вопрос исследования: отличается ли среднее значение ИМТ в популяции взрослых (возраст ≥ 18) от исторического значения **28.5**?

Рассмотрим рраспределение признака
```{r fig.width=8, fig.height=5}
#Визуализируем данные
nhanes_clean_mine %>% 
  ggplot() +
  geom_histogram(aes(x = BMI), fill = 'skyblue3', colour = 'grey20')+
  geom_vline(xintercept = 28.5, color = "green4", linetype = "dashed", linewidth = 1)+
  labs(
    title = 'Распределение значений ИМТ пациентов исследования',
    y = 'Количество пациентов',
    x = 'ИМТ',
    caption = 'Зеленая линия: историческое значение (ИМТ = 28.5)'
  )+
  scale_y_continuous(breaks = seq(0,600, 50))+
  scale_x_continuous(breaks = seq(0,80,5))
```

Распределение имеет один пик, в целом куполообразно с длиннным хвостом в сторону больших значений, который невозможен в сторону значений близких к 0. Рассмотрим распределение признака ИМТ как нормальное. 

Видно, что историческое среднее значение приближено к пику значений нашего наблюдения.

#### Задания:

##### Задание 1.1

Сформурируйте нулевую гипотезу и альтернативная гипотеза

-   $H_0$: среднее значение ИМТ в популяции взрослых (возраст ≥ 18) НЕ отличается от исторического значения **28.5**
-   $H_a$: среднее значение ИМТ в популяции взрослых (возраст ≥ 18) отличается от исторического значения **28.5**

##### Задание 1.2

Посчитайте ключевые статистики (среднее, стандартное отклонение, размер выборки) для переменной BMI в вашем чистом наборе данных `nhanes_clean`.

```{r descriptive-stats-bmi}
# Расчет ключевых статистик для BMI

nhanes_clean_mine %>% 
  summarise(
    'Мин' = min(BMI),
    '1 квартиль' = quantile(BMI, 0.25),
    'Среднее' = round(mean(BMI), 1),
    'Cтандартное отклонение' = round(sd(BMI), 1),
    '3 квартиль' = quantile(BMI, 0.75),
    'Макс' = max(BMI),
    'Размер выборки' = n()
  ) 

```
Полученное среднее близко к историческому.

##### Задание 1.3

Выберите подходящий статистический тест для проверки гипотез из задания 1.1 и объясните свой выбор.

Т.к. нам необходимо сравнить среднее нашего признака одной группы с известным (историческим) значением, при этом наш признак, ИМТ, явялется непрервным количественным признаком распределённым нормально, а объем выборки достаточно большой, что с высокой вероятностью нормалирует распределения выборочных средних, в качестве статистического теста мы можем использовать одновыборочный Т-тест Стьюдента.

##### Задание 1.4

Используя выбранный тест, проверьте гипотезы из задания 1.1 на уровне значимости α = 0.1.

```{r test-bmi}

mu_0_bmi <- 28.5


# Выполнение теста
 test_BMI <- t.test(
  x = nhanes_clean_mine$BMI,
  mu = mu_0_bmi,
  conf.level = 0.9
)

print(test_BMI) 
```

##### Задание 1.5

Как p-значение и 90% доверительный интервал информируют вас об общем статусе ИМТ этой популяции относительно среднего значения в общей популяции в 28.5? Что вы можете сказать про статистическую значимость?

Полученное p-значение больше 0.1, что не дает нам оснований опровергнуть нулевую гипотезу о равенстве среднего ИМТ в данной популяции и исторического значения среднего. 90% ДИ [28.15, 28.53] включает историческое среднее равное 28.5, хоть и близко к верхней границе. Полученные значения дают нам возможность говорить об отсутствии статистической значимой разницы среднего в данной популяции и исторического среднего.

ТАКИМ ОБРАЗОМ:
Согласно результатам одновыборочного Т-теста, среднее ИМТ данной популяции статистически значимо не отличается от исторического среднего по уровню значимости 0.1 (p = 0.1692), оценка средней равна 28.34, 90% ДИ [28.15, 28.53].


### 2. Сравнение давления у мужчин и женщин

Сценарий: Исследователи хотят сравнить систолическое артериальное давление у мужчин и женщин. Вопрос исследования: Есть ли статистически значимая разница в среднем систолическом артериальном давлении ($\mathbf{BPSysAve}$) между **мужчинами** и **женщинами**?

Расссмотрим распределения признаков

В данных примерно прослеживается пик, у мужчин в районе 120, у женщин - 110. Т.к. значения этого параметра мы жестко осекали, разбросы данных одинаковы, медианы располагаются примерно по центру между 1 и 3 квартилем, замечено смещение значений у мужчин в сторону больших. Значения параметра будем рассматривать как распределенные нормально. 

```{r fig.width=12, fig.height=5}

BPSysAve_sex_hist <- nhanes_clean_mine %>% 
  ggplot(aes(x = BPSysAve))+
  geom_histogram(aes(fill = Gender), colour = 'black', bins = 40)+
  facet_grid(Gender~., labeller = labeller(Gender = c('male' = 'Мужчины','female' = 'Женщины')))+
  labs(
    
    x  = 'Систолическое артериальное давление',
    y = 'Количество пациентов'
  )+
  scale_fill_manual(
    values = c('male' = 'deepskyblue2',
               'female' = 'coral2')
  )+
  scale_y_continuous(breaks = seq(0, 150, 25))+
  scale_x_continuous(breaks = seq(50, 125, 5))+
  theme(
    axis.title = element_text(size = 15),
    legend.position = 'none',
    axis.text = element_text(size = 11)
  )


BPSysAve_sex_box <- nhanes_clean_mine %>% 
  ggplot(aes(x = Gender, y = BPSysAve))+
  geom_jitter(width = 0.3, colour = 'grey40', shape = 1)+
  geom_boxplot(aes(fill = Gender), width = 0.5)+
  labs(
    
    x  = NULL,
    y = 'Систолическое артериальное давление'
  )+
  scale_fill_manual(
    values = c('male' = 'deepskyblue2',
               'female' = 'coral2')
  )+
  scale_x_discrete(
    labels = c('male' = 'Мужчины',
               'female' = 'Женщины')
  )+
  # coord_cartesian(ylim = c(50, 250))+
  scale_y_continuous(breaks = seq(90, 130, 5))+
  theme(
    plot.title = element_text(hjust = 0.5, size = 15),
    legend.position = 'none',
    axis.title = element_text(size = 15),
    axis.text.x = element_text(size = 15, colour = 'black'),
    axis.text.y = element_text(size = 11)
    
  ) 

(BPSysAve_sex_hist | BPSysAve_sex_box)+
    plot_annotation(
    title = "Распредление среднего систолического артериального давления у мужчин и женщин",
    theme = theme(plot.title = element_text(hjust = 0.5, size = 18)))
```

##### Задание 2.1

Сформулируйте нулевую и альтернативную гипотезы

-   $H_0$: Средние систолического артериального давления у мужчин и женщин НЕ различаются.
-   $H_a$: Средние систолического артериального давления у мужчин и женщин различаются.

Подумайте, имеет ли значение, в какой группе давление больше
Наша нулевая гипотеза предполагает обнаружение любого отклонения от равенства. Т.к. у нас нет явной необходимости и конкретных оснований проверять гипотезу о повышенном значении САД в одной из групп, мы остановимся на поиске любых различий.

##### Задание 2.2

Посчитайте ключевые статистики (среднее в каждой группе, стандартное отклонение, размер каждой группы) для переменной `BPSysAve` в вашем чистом наборе данных `nhanes_clean`. Группы определяются переменной `Gender`.

```{r stats-BPSysAve}
nhanes_clean_mine %>% 
  rename ('Пол' = Gender) %>% 
  group_by(Пол) %>% 
  summarise(
    'Мин' = min(BPSysAve),
    '1 квартиль' = quantile(BPSysAve, 0.25),
    'Среднее' = round(mean(BPSysAve), 1),
    'Cтандартное отклонение' = round(sd(BPSysAve), 1),
    '3 квартиль' = quantile(BPSysAve, 0.75),
    'Макс' = max(BPSysAve),
    'Размер группы' = n()
  )

```
Значения средних различаются на 5 мм.рт.ст, квартили группы мужчин смещены в сторону больших значений.

##### **Задание 2.3**

Выберите подходящий статистический тест для проверки гипотез из задания 2.1 и объясните свой выбор.

Т.к. нам необходимо сравнить средние значения нашего признака между двумя независимыми группами, при этом наш признак, систолическое артериальное давление, явялется непрервным количественным признаком, распределенным нормально, обе группы имеют похожий разброс данных и достаточно большой объем наблюдений (около 1500), что с высокой вероятностью нормалирует распределения выборочных средних, в качестве статистического теста мы можем использовать Т-тест Стьюдента для сравнения двух независимых групп. Мы используем двусторонний тест, т.к. нам важно только наличие различий между группы без указания направления.

##### **Задание 2.4**

Используя выбранный тест, проверьте гипотезы из задания 2.1 на уровне значимости α = 0.1.

```{r BPSysAve-test}
# Выполнение теста

test_BPSysAve <- t.test( BPSysAve ~ Gender,
  data = nhanes_clean_mine,
  conf.level = 0.9,
  var.equal = FALSE # var.equal = FALSE использует поправку Уэлча (рекомендуется)
)

print(test_BPSysAve)

```

##### Задание 2.5

Как p-значение и 90% доверительный интервал информируют вас о разнице измеренного артериального давления между мужчинами и женщинами? Что вы можете сказать про статистическую значимость?

Полученное p-значение меньше 0.1, что дает нам возможность опровергнуть нулевую гипотезу о равенстве средних в двух группах. 90% ДИ [-3.99, -2.99] разницы средних не включает 0. Т.к. ДИ находится в области отрицательных значений и t-критерий равен -11.56, мы можем говорить о пониженных значениях артериального давления у женщин в сравнении с мужчинами. Полученные значения дают нам возможность говорить о статистической значимости различий средних в двух группах. 

ТАКИМ ОБРАЗОМ:
Согласно результатам Т-теста для двух независимых групп, средние систолического артериального давления у мужчин и женщин статистически значимо различаются по уровню значимости 0.1 (p = 2.2e-16), оценка средних равна 111 и 115 для женщин и мужчин соответственно, 90% ДИ разницы средних [-3.99, -2.99].

### 3: Сравнение систолического и диастолического давления

Сценарий: Измерения систолического ($\mathbf{BPSysAve}$) и диастолического ($\mathbf{BPDiaAve}$) давления не являются независимыми. Вопрос исследования: Равна ли нулю средняя **разница** между систолическим ($\mathbf{BPSysAve}$) и диастолическим ($\mathbf{BPDiaAve}$) давлением (пульсовое давление) в исследуемой популяции?

Рассмотрим распределение систолического и диастолического артериального давления и их разницы.

```{r fig.height=5, fig.width=10}
BPDiaAvehistnew <- nhanes_clean_mine %>% 
  ggplot()+
  geom_histogram(aes(x = BPDiaAve), fill = 'seagreen', colour = 'black', bins = 25)+
  labs(
    x = 'Значения среднего диастолического давления',
    y = 'Количество пациентов'
  )+
  scale_x_continuous(breaks=seq(60,80,5))+
  scale_y_continuous(breaks=seq(0,200,25))

BPSysAvehistnew <- nhanes_clean_mine %>% 
  ggplot()+
  geom_histogram(aes(x = BPSysAve), fill = 'sienna3', colour = 'black',bins = 35)+
  labs(
    x = 'Значения среднего систолического давления',
    y = NULL
  )+
  scale_x_continuous(breaks=seq(90,130,5))+
  scale_y_continuous(breaks=seq(0,1000,100))+
  theme(
     axis.text.y = element_blank()
  )



(BPDiaAvehistnew|BPSysAvehistnew)+
    plot_annotation(
    title = "Распределение значений среднего диастолического и систолического давления",
    theme = theme(plot.title = element_text(hjust = 0.5, size = 15)))
```
Распределения диастолического и артериального давления имеют примерно куполообразное распределение и пик в районе 70 и 115 соответсвенно.


```{r fig.width=8}
nhanes_clean_mine_BRdif <- nhanes_clean_mine %>% 
  mutate(
    differense = BPSysAve-BPDiaAve
  )

BRdifhist <- nhanes_clean_mine_BRdif %>% 
  ggplot()+
  geom_histogram(aes(x = differense), fill = 'peachpuff3', colour = 'black', bins =45) +
  labs(
    title = 'Распределение разностей систолического и артериального давления',
    x = 'Разность систолического и артериального давления',
    y = 'Количество наблюдений'
  )+
  scale_y_continuous(breaks = seq(0,250, 25))+
  scale_x_continuous(breaks = seq(20,70, 5))

BRdifhist
```
Из разницы также распределены куполообразно и имеют пик в районе 45, и еще две области значений с повышенным количеством наблюдений около 35 и 55. Распределения признаков и их разницы будем рассматривать как нормальное.

##### Задание 3.1 + ИЗМЕНЕНИЯ

Ваш комментарий:
“Т.к. мы в целом биологически невозможно, что САД будет иметь значения ниже
ДАД, мы можем оценить их разницу более точно с помощью одностороннего теста.” -
но разве, если использовать двусторонний тест, разница будет оценена менее
точно?

Сформулируйте нулевую и альтернативную гипотезы

-   $H_0$: Разница средних систолического и диастолического давления меньше или равна 0.
-   $H_a$: Разница средних систолического и диастолического давления больше 0.

Подумайте, имеет ли значение, в какой группе давление больше
Т.к. в целом биологически невозможно, что САД будет иметь значения ниже ДАД, мы можем оценить их разницу <u>с помощью одностороннего теста, повысив тем самым его мощность при заданной α.</u>

##### Задание 3.2

Посчитайте ключевые статистики для переменной `BPSysAve` и `BPSysAve` в вашем чистом наборе данных `nhanes_clean`.

```{r descriptive-stats-BPSysAve-BPDiaAve}
nhanes_clean_presdif <-  nhanes_clean_mine %>% 
  mutate(
    'Разница' = BPSysAve - BPDiaAve
  )

nhanes_clean_presdif %>%
  rename('Cистол.' = BPSysAve,
         'Диастол.' = BPDiaAve) %>% 
  pivot_longer(cols = c('Cистол.', 'Диастол.', 'Разница'), names_to = 'Давление', values_to = 'Измерения') %>%
  group_by(Давление) %>% 
  summarise(
    'Мин' = min(Измерения),
    '1 квартиль' = quantile(Измерения, 0.25),
    'Среднее' = round(mean(Измерения), 1),
    'Cтандартное отклонение' = round(sd(Измерения), 1),
    '3 квартиль' = quantile(Измерения, 0.75),
    'Макс' = max(Измерения),
    'Размер группы' = n()
  )
```

Среднее значение разницы давлений значительно превосходит 0, 1 квартиль также отдален от 0.

**Дополнительно (необязательное задание)** Визуализируйте эти параметры. Используйте боксплот, свяжите линиями измерения одного пациента.

```{r}
nhanes_clean_mine %>% 
  pivot_longer(cols = c('BPSysAve', 'BPDiaAve'), names_to = 'Давление', values_to = 'Измерения') %>%
  ggplot(aes(x = Давление, y = Измерения ))+
  geom_line( aes(group = id), alpha = 0.2, colour = 'grey40' )+
  geom_boxplot( aes(fill = Давление), width = 0.5)+
  labs(
    title = 'Индивидуальные разности измерений САД и ДАД',
    x = NULL,
    y = 'Значения измерений, мм.рт.ст.'
  )+
  scale_fill_manual(
    values = c('BPSysAve' = 'sienna3',
               'BPDiaAve' = 'seagreen' )
  )+
  scale_y_continuous(breaks = seq(60,150,5))+
  scale_x_discrete(labels = c('BPSysAve' = 'САД',
               'BPDiaAve' = 'ДАД' ))+
  theme(
    axis.text = element_text(colour = 'black', size = 12),
     legend.position = 'none'
  )
  
```

Из графиков видно, что индивидуальные значения САД значительно превосходят значения ДАД

##### Задание 3.3

Выберите подходящий статистический тест для проверки гипотез из задания 3.1 и объясните свой выбор.

Т.к. нам необходимо определить равенство разницы средних значений двух парных признаков и 0, при этом наши признаки, систолическое и диастолическое артериальное давление, явялются непрерывными количественным признакоми, имеют нормальное распредление значений разницы, а объем обоих групп достаточно большой (около 3000), что с высокой вероятностью нормалирует распределения выборочных средних. Т.к. по условияю признаки не являются независимыми, в качестве статистического теста мы можем использовать парный Т-тест Стьюдента. Мы используем односторонний тест, т.к. проверяем гипотезу о превышении разницы 0 .

##### Задание 3.4

Используя выбранный тест, проверьте гипотезы из задания 3.1 на уровне значимости α = 0.1.

```{r}
#paired = TRUE указывает, что измерения парные

test_BP_pair <- t.test(nhanes_clean_mine$BPSysAve, nhanes_clean_mine$BPDiaAve, paired = TRUE,alternative = "great", conf.level = 0.9)


print(test_BP_pair)
```

##### Задание 3.5 + ИСПРАВЛЕНИЯ

ВАш комментарий:
“разница средних систолического и диастолического давления в исследуемой
популяции статистически значимо НЕ равна 0” - лучше сформулировать по-другому.
Разница средних может стат. значимо или стат. не значимо отличаться от нуля в
выборке, а не в популяции. Обычно рассматриваем “популяция” как синоним “ген.
совокупность”.


Как p-значение и 90% доверительный интервал информируют вас о разнице измеренного систолического и диастолического артериального давления? Что вы можете сказать про статистическую значимость?

Полученное p-значение меньше 0.1, что дает нам возможность опровергнуть нулевую гипотезу о равенстве нулю разницы систолического и артериального значения. 90% ДИ [42.83, inf] разницы средних не включает 0.

ТАКИМ ОБРАЗОМ:
Согласно результатам одностороннего парного Т-теста, разница средних систолического и диастолического давления <u>у исследуемых пациентов</u> статистически значимо НЕ равна 0 и не меньше 42,8 по уровню значимости 0.1 (p = 2.2e-16), оценка среднего равна 43, 90% ДИ разницы средних [42.83, inf] не включает 0.

------------------------------------------------------------------------

## Непараметрические тесты

Допустим, мы хотим сравнить статистическое доминирование ИМТ, а не средние абсолютные значения

### 4: Сравнение ИМТ мужчин и женщин при помощи непараметрических тестов

Вопрос исследования: Отличаются ли превосходят ли как правило ИМТ ($\mathbf{BMI}$) у представителей одного пола относительно другого?

Рассмотрим распределение признака по группам. 

```{r}
nhanes_clean_mine %>% 
  ggplot() +
  geom_histogram(aes(x = BMI, fill = Gender), colour = 'grey20')+
  geom_boxplot(aes(x = BMI, y = 350, fill = Gender), width = 20)+
  facet_grid(Gender~., labeller = labeller(Gender = c('male' = 'Мужчины','female' = 'Женщины')))+
  labs(
    title = 'Распределение значений ИМТ в популяции взрослых в США',
    y = 'Количество пациентов',
    x = 'ИМТ'
  )+
  coord_cartesian(ylim = c(0, 370))+
  scale_fill_manual(
    values = c('male' = 'deepskyblue2',
               'female' = 'coral2'))+
  scale_y_continuous(breaks = seq(0,600, 50))+
  scale_x_continuous(breaks = seq(0,80,5))+
  theme(
    legend.position = 'none'
  )

```

В обоих группах распределение похоже, имеет один пик в районе 25-30, в целом куполообразно с длиннным хвостом в сторону больших значений, который невозможен в сторону значений близких к 0.

##### Задание 4.1

Сформулируйте нулевую и альтернативную гипотезы

\$H_0\$: Значения ИМТ мужчин и женщин находятся в стохастическом равенстве

\$H_a\$: Значения ИМТ мужчин и женщин не находятся в стохастическом равенстве

Мы не будем проверять гипотезу о превосходстве значений в одной из групп, т.к. для этого нужно предполагать какая из них будет превосходить. В качестве первого шага анализа различий ИМТ используем двусторонюю гипотезу, учитывающую различия в обе стороны.

##### Задание 4.2

Посчитайте ключевые статистики (количество пациентов в каждой группе и другие статистики по необходимости)

```{r descriptive-stats-IMT}
nhanes_clean %>% 
  rename('Пол' = 'Gender') %>% 
  group_by(Пол) %>% 
  summarise(
    'Мин' = min(BMI),
    '1 квартиль' = quantile(BMI, 0.25),
    'Медиана' = median(BMI),
    '3 квартиль' = quantile(BMI, 0.75),
    'Макс' = max(BMI),
    'Размер группы' = n()
  )
```

Объясните, почему выбор статистик отличается для этого сценария от сценариев 1, 2 и 3.

Т.к. здесь, в отличае от прошлых пунктов, нам нужно подробнее оценить распределение, мы преимущественно обращаемся к стататискам медианы и квартилей.

Здесь исходя из статистик медианы и квартили у женщин немного превосходят соответсвующие значения мужчин (до 1 еденицы). Максимум ИМТ у женщин выше, из распределения также видно, что у женщин наблюдается бОльше число аномальных значений с высоким ИМТ (>55).

##### Задание 4.3

Обоснуйте, является ли тест Манна-Уитни подходящим для проверки гипотез из задания 4.1 и объясните свой выбор.

Имеет ли значение для выбора теста, сколько пациентов в каждой группе? Что, если бы в одной группе было бы 10 пациентов или меньше? А если 2 пациента?

Являются ли группы зависимыми или независимыми?

Группы являются независимыми, группы мужчин и женщин не связаны и не влияют друг на друга.

Т.к. нам необходимо сравнить распредления значений количественного признака (т.е. его возможно ранжировать) друх независимых групп в качестве статистического теста мы можем использовать тест Манна-Уитни. Мы используем двусторонний тест, т.к. нам важно только наличие различий между группами без указания направления.

Размер выборки может влиять на выбор теста, т.к. это влияет на его эффективность. Так, для теста Манна-Уитни можно использовать выбоки, в среднем меньшие минимальным порогам других тестов.  
2 пациента - критически малая группа, из которой нельзя получить никакие достоверные результаты.
10 - мало, но лучше. С таким небольшими выборками часто проходится работать на этапах доклинических испытаний. Поэтому является довольно популярной необходимостью. 

##### Задание 4.4

Проверьте гипотезы из задания 4.1 на уровне значимости α = 0.1. 

```{r bmi-gender-test}

bmi_gender_test <- wilcox.test(BMI ~ Gender, 
  data = nhanes_clean_mine)


print(bmi_gender_test)

```

##### Задание 4.5 + ИЗМЕНЕНИЯ

Ваш комментарий:
“Согласно результатам теста Манна-Уитни, распределение значений ИМТ в двух
группах статистически значимо различается” - но тест МУ не является тестом для
сравнения распределений


Как p-значение и 90% доверительный интервал информируют вас разнице между группами? Что вы можете сказать про статистическую значимость?

Полученное p-значение меньше 0.1, что дает нам возможность опровергнуть нулевую гипотезу о равенстве распределений значений ИМТ в двух группах.

ТАКИМ ОБРАЗОМ:
Согласно результатам теста Манна-Уитни, <u>значения</u> ИМТ в двух группах статистически значимо различается по уровню значимости 0.1 (p = 0.000855).

### 5 Разница между медианами САД и ДАД

Сценарий: Вопрос исследования: превосходят ли, как правило, значения одного типа артериального давления значения другого типа (САД vs. ДАД)? САД - систолическое артериальное давление, ДАД - диастолическое артериальное давление


Рассмотри распределение разницы САД и ДАД
```{r}
nhanes_clean_mine_BRdif %>% 
  ggplot()+
  geom_histogram(aes(x = differense), fill = 'peachpuff3', colour = 'black', bins =45) +
  geom_boxplot(aes(x = differense, y = 250), width = 10, fill = 'peachpuff3')+
  coord_cartesian(ylim = c(0,255))+
  labs(
    title = 'Распределение разностей систолического и артериального давления',
    x = 'Разность систолического и артериального давления',
    y = 'Количество наблюдений'
  )+
  scale_y_continuous(breaks = seq(0,250, 25))+
  scale_x_continuous(breaks = seq(20,70, 5))

```

Из распределения видно, что медиана расположена сильно дальше 0 и даже минимальное значение разницы равно положительному, неблизкому к 0 значению.

##### Задание 5.1 + ИЗМЕНЕНИЯ

Ваш комментарий:
Для теста Уилкоксона нулевая гипотеза сформулирована неверно: “Распределения
разности значений парных измерений САД и ДАД симметричны относительно 0”

Сформулируйте нулевую и альтернативную гипотезы

-   $H_0$: <u>Медиана разности значений</u> парных измерений САД и ДАД равна 0
-   $H_a$: <u>Медиана разности значений</u> парных измерений САД и ДАД смещена в положительную сторону

##### Задание 5.2

Посчитайте ключевые статистики для переменной `BPSysAve` и `BPDiaAve` в вашем чистом наборе данных `nhanes_clean`. Обратите внимание, что это иные статистики, чем в задании 3.

```{r descriptive-stats-pressure-alternative}

nhanes_clean_presdif %>%
  rename('Cистол.' = BPSysAve,
         'Диастол.' = BPDiaAve) %>% 
  pivot_longer(cols = c('Cистол.', 'Диастол.', 'Разница'), names_to = 'Давление', values_to = 'Измерения') %>%
  group_by(Давление) %>% 
  summarise(
    'Мин' = min(Измерения),
    '1 квартиль' = quantile(Измерения, 0.25),
    'Среднее' = round(mean(Измерения), 1),
    'Cтандартное отклонение' = round(sd(Измерения), 1),
    '3 квартиль' = quantile(Измерения, 0.75),
    'Макс' = max(Измерения),
    'Размер группы' = n()
  )

```

**Дополнительно (необязательное задание)** Визуализируйте эти параметры. Используйте violinplot и boxplot, свяжите линиями измерения одного пациента. Визуально оцените, как выглядит распределение обеих переменных

```{r}
nhanes_clean_mine %>% 
  pivot_longer(cols = c('BPSysAve', 'BPDiaAve'), names_to = 'Давление', values_to = 'Измерения') %>%
  ggplot(aes(x = Давление, y = Измерения ))+
  geom_violin(aes(fill = Давление))+
  geom_line(aes(group = id), alpha = 0.2, colour = 'grey40')+
  geom_boxplot(width=0.1)+
  labs(
    title = 'Индивидуальные разности измерений САД и ДАД',
    x = NULL,
    y = 'Значения измерений, мм.рт.ст.'
  )+
  scale_fill_manual(
    values = c('BPSysAve' = 'sienna3',
               'BPDiaAve' = 'seagreen' ), 
    labels = c('BPSysAve' = 'САД',
               'BPDiaAve' = 'ДАД' )
  )+
  scale_y_continuous(breaks = seq(60,150,5))+
  scale_x_discrete(labels = c('BPSysAve' = 'САД',
               'BPDiaAve' = 'ДАД' ))+
  theme(
    axis.text = element_text(colour = 'black', size = 12),
    legend.position = 'none'
  )
```

Распределения диастолического и артериального давления имеют примерно куполообразное распределение. У значений ДАД наблдается три пика - в районе 65, 70 и 75. У САД один перимущественных пик в районе 115.
Индивидуальные значения ДАД превосходят значения САД.

##### Задание 5.3

Выберите подходящий статистический тест для проверки гипотез из задания 5.1 и объясните свой выбор.

Т.к. нам нужно сравнить симметричность распределения разностей систолического и диастолического давления относительно 0 у количественных (т.е. их возможно ранжировать) связанных признаков в качестве статистического теста мы можем использовать тест Уилкоксона для связанных выборок. Мы используем односторонний тест, т.к. исходно предполагаем превосходство значений систолического давления в сравнении с диастолическим.

##### Задание 5.4

Используя выбранный тест, проверьте гипотезы из задания 5.1 на уровне значимости α = 0.1.

```{r}
# paired = TRUE указывает, что измерения парные
test_BP_Wt <- wilcox.test(
  x = nhanes_clean_mine$BPSysAve,
  y = nhanes_clean_mine$BPDiaAve,
  alternative = "greater", # Проверяем, что систолическое больше диастолического
  paired = TRUE, 
  
  #вывод ДИ
  conf.int = TRUE, 
  conf.level = 0.9, 
  exact = FALSE
  
)


print(test_BP_Wt)
```

##### Задание 5.5 + ИЗМЕНЕНИЯ

Ваш комментарий:
В wilcox.test() есть ещё аргумент для вывода ДИ

Как p-значение и 90% доверительный интервал информируют вас о разнице измеренного систолического и диастолического артериального давления? Что вы можете сказать про статистическую значимость?

Полученное p-значение меньше 0.1, что дает нам возможность опровергнуть нулевую гипотезу о симметричности распределений относительно 0.

ТАКИМ ОБРАЗОМ:
Согласно результатам теста Уилкоксона для связанных выборок, <u>медиана разницы САД И ДАД статистически значимо смещена в положительную сторону по уровню значимости 0.1 (p = 2.2e-16). Оценка значения медианы равна 42.99996 с 90% ДИ [42.99992, Inf], не включающим и значительно превышающим 0.</u>

------------------------------------------------------------------------

# Тесты для категориальных данных

### 6: Поиск зависимости между физической активностью и проблемами со сном 

Вы хотите исследовать, есть ли взаимосвязь между проблемами со сном у человека и тем, занимается ли он физической активностью. Переменные: $\mathbf{PhysActive}$ --- бинарный признак (1 = активно занимается, 0 = не занимается), $\mathbf{SleepTrouble}$ --- бинарный признак (1 = есть проблемы со сном, 0 = нет проблем). 

#### Задания:

##### Задание 6.1

Сформулируйте нулевую и альтернативную гипотезы для проверки связи между физической активностью и проблемами со сном. Какую альтернативу вы используете --- одностороннюю или двустороннюю? Обоснуйте ответ

- $H_0$: Физическая активность и проблемы со сном являются независимыми событиями.
- $H_a$: Физическая активность и проблемы со сном являются НЕ независимыми событиями.

##### Задание 6.2

Постройте таблицу сопряженности и визуализируйте ее. Исходя из полученной таблицы и иллюстрации, как вам кажется, похожи ли наши признаки на независимые? Почему? 

```{r}
tabl_act_sleep <- table(nhanes_clean_mine$PhysActive, nhanes_clean_mine$SleepTrouble)

nhanes_clean_mine %>% 
  group_by(PhysActive) %>% 
  summarise(
    'Есть проблемы со сном' = sum(SleepTrouble == 'Yes'),
    'Нет проблем со сном' = sum(SleepTrouble == 'No')
  ) 


```


```{r}
mosaicplot(tabl_act_sleep, color = c('seagreen','grey40'), xlab = 'Физическая активность', ylab = 'Проблемы со сном', main = 'Распредление количества пациентов с проблемами \nсо сном по группам физической активности')

```

Исходя из таблицы сопряженности и графика видно, что у большей части пациентов обоих групп физической активности нет проблем со сном. При этом признак наличие/отсутсвие активности имеет примерно равные пропорции количества пациентов с проблемами со сном. Поэтому можно сделать вывод, что признаки скорее независимые и их разница будет иметь низкую клиническую значимость.

##### Задание 6.3

Какой статистический тест подходит для тестирования гипотезы из 6.1 (Хи-квадрат, Фишер, МакНемара)? Объясните свой выбор. Какие ограничения у выбранного теста? Если нужно, проверьте ограничения

Оба признака непарные являются качественными и бинарными. У исследования достаточно большая выборка пациентов. Учитывая наш исследовательский вопрос и перечисленные характеристики признака, мы можем воспользоваться тестом двух пропорций для бинарного признака или критерием Хи-квадрат для проверки независимости. Мы остановимся на втором варианте.

##### Задание 6.4

Используя выбранный тест, проверьте гипотезы из 6.1 на уровне значимости α = 0.05. Какое p-значение и значение статистики критерия получилось? Что вы можете сказать про статистическую значимость? 

Совпадает ли результат статистического анализа с вашим предположением в 6.2? Если нет, попробуйте объяснить почему

```{r}

chisq.test(tabl_act_sleep)
```
Согласно полученному критерию Хи-квадрат для проверки независимости, физическая активность и проблемы со сном имеют статистически значимую взаимосвязь по уровню значимости 0.05 (p = 0.01565, X-квадрат = 5.8412). 

Однако, т.к. значение X-квадрат небольшое, полученное значение р располагается на границе заданного значения α, можно сказать, что, хотя статистически значимая взаимосвязь обнаружена, она явялется неявной (как мы видим это из результатов визуализации таблицы сопряженности), слабой и скорее клинически незначимой. Это объясняет несовпадении выводов, сделанных на основе визуализации и статистического теста.

##### Задание 6.5

Посчитайте размер эффекта (отношение шансов и отношение рисков, если это имеет смысл для этого исследования) двумя способами -- самостоятельно (посчитайте дроби исходя из таблицы сопряженности), и с помощью пакета epitools, сравните результаты. Проинтерпретируйте результат с точки зрения клинической значимости (не забудьте про 95% доверительный интервал!). Прокомментируйте, почему вы решили считать или не считать отношение рисков. 


Обе перменные бинарные, данные получены в результате поперечного исследования, т.к. здесь не было исходного закрепления количества пациентов в когортах, следовательно в качестве меры ассоциации мы можем использовать OR и RR.

```{r}
nhanes_clean_mine %>% 
  group_by(PhysActive) %>% 
  summarise(
    "Есть проблемы со сном" = sum(SleepTrouble == 'Yes'),
    "Нет проблем со сном" = sum(SleepTrouble == 'No'),
    "Всего" = n()
  )  %>% 
  bind_rows(
    summarise(., across(where(is.numeric), sum), PhysActive = "Всего"))
```

ОТНОШЕНИЕ ШАНСОВ
Шанс наличия в группе пациентов, не занимающихся спортом, проблем со сном
= 382/951 = 0.40

Шанс наличия в группе пациентов, занимающихся спортом, проблем со сном
= 441/1342 = 0.33

Отношение шансов наличия проблем со сном у пациентов, занимающихся спортом, к пациентам, не занимающихся спортом:
OR = 0,33/0.40 = 0.825, что близко к 0, т.е. шансы наличия проблем со сном у пациентов занимающихся сортом ниже, однако значение отношения близко к 0, поэтому на практике данная закономерность может не иметь клинической значимости. Таким образом, обнаружена небольшая отрицательная ассоциация между занятием спортом и наличием проблем со сном.


ОТНОШЕНИЕ РИСКОВ
Риск наличия проблем со сном в группе пациентов, занимающися спортом
=441/1783 = 0.23

Риск наличия проблем со сном в группе пациентов, не занимающися спортом
=382/1333 = 0.27

Отношение рисков наличия проблем со сном у группы пациентов занимающихся спортов к пациентам, не занимающихся спортом
=0.23/0.27 = 0.85, т.е. риск наличия проблем со сном в группе пациентов не занимающихся спортом ниже и примерно совпадает с OR. Таким образом, обнаружена отрицательная ассоциация между занятием спортом и наличием проблем со сном. 

```{r}
#То, что считаем отсутвием исхода (отсутвие проблем со сном) стоит в верхнем левом углу
# tabl_act_sleep

oddsratio(tabl_act_sleep)
```
Согласно результатам функции OR = 0.82, что совпадает с рассчитанным самостоятельно, 95% ДИ [0.697-0.960] не включает 1, хотя верхняя граница близка к 1. Все три рассчитанных р-значения < 0.05.

```{r}
riskratio(tabl_act_sleep)
```
Согласно результатам функции RR = 0.86, что совпадает с рассчитанным самостоятельно, 95% ДИ [0.768-0.970] не включает 1, хотя верхняя граница близка к 1. Все три рассчитанных р-значения < 0.05.

Исходя из полученных значений, подтверждающих друг друга, мы можем сделать вывод о наличии статистически значимой ассоциации между заниятием спортом и отсутствием проблем со сном (OR = 0.82 [0.697-0.960], RR = 0.86 [0.768-0.970]) по уровню значимости 0.05. Одноко, полученные нами значения параметров и ДИ близки к 1 поэтому требуют дальнейшей проверки и возможно не являются клинически значимыми.

##### Задание 6.6

Исходя из результатов статистического анализа, можем ли мы сделать вывод, что физическая активность улучшает сон? Или что люди, которые лучше спят, чаще занимаются спортом? 

Мы моем утверждать о статистически значимой ассоциации, но НЕ о направлении влияния. 

------------------------------------------------------------------------

# Поиск зависимостей между количественными / порядковыми признаками

### 7. Анализ зависимости между ростом и массой тела

Вопрос. Есть ли линейная связь между ростом (Height) и весом (Weight) у участников NHANES старше 18 лет?

#### Задание 7.1

Сформулируйте нулевую и альтернативную гипотезы.

-   $H_0$: Линейной связь между ростом и весом у участников NHANES старше 18 лет нет.
-   $H_a$: Линейная связь между ростом и весом у участников NHANES старше 18 лет есть.

#### Задание 7.2

Визуализируйте распределения анализируемых переменных. Визуально оцените форму распределений и наличие выбросов.

```{r fig.width=13, fig.height=5}
heightbar <- nhanes_clean_mine %>% 
  ggplot() +
  geom_histogram(aes(x = Height), fill = 'seagreen', colour = 'black')+
  geom_boxplot(aes(x = Height, y = 290), width = 10, fill = 'seagreen', colour = 'black')+
  labs(
    title = 'Распределение значений роста у пациентов',
    y = 'Количество пациентов',
    x = 'Рост, см'
  )+
  coord_cartesian(ylim = c(0, 300))+
  scale_x_continuous(breaks = seq(140,200,5))+
  scale_y_continuous(breaks = seq(0,600,50))+
  theme(
    plot.title = element_text(size = 18),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 13)
  )


hhibar <- nhanes_clean_mine %>% 
  ggplot() +
  geom_histogram(aes(x = Weight), fill = 'sienna3', colour = 'black')+
  geom_boxplot(aes(x = Weight, y = 480), width = 18, fill = 'sienna3', colour = 'black')+
  labs(
    title = 'Распределение значений веса у пациентов',
    y = 'Количество пациентов',
    x = 'Вес, кг'
  )+
  coord_cartesian(ylim = c(0,500))+
  scale_x_continuous(breaks = seq(25,250,25))+
  scale_y_continuous(breaks = seq(0,1000,100))+
  theme(
    plot.title = element_text(size = 18),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 13)
  )

heightbar|hhibar
```

Распределение роста иммет один пик, в целом купалообразное. Наблюдается небольшой диапазон экстремальный значений в районе 200 см.
Распределение Веса имеет один пик, в целом куполообразно с длиннным хвостом в сторону больших значений, который невозможен в сторону значений близких к 0. Наблюдается значительное количество анамальных значений в диапазоне 130-230 кг.

Рассмотрим распределение обоих признаков как нормальное.

Постройте диаграмму рассеяния Height vs Weight (график должен быть читаемым), оцените линейность связи признаков.

```{r}
nhanes_clean_mine %>% 
  ggplot(aes(x = Height, y = Weight))+
  geom_point(colour = 'grey20', alpha = 0.3)+
  geom_smooth(method = 'lm', se = FALSE, colour = 'purple')+
  labs(
    title = 'Взаимосвязь роста и веса пациентов',
    x = 'Рост, см',
    y = 'Вес, кг'
  )+
  scale_x_continuous(breaks = seq(140,200,5))+
  scale_y_continuous(breaks = seq(25,250,25))

```

Точки примерно распределены вдоль воображаемой прямой, есть некоторые анамальные значения, сильно отклонившиеся от линии тренда. В целом можем говорить о наличии линейной взаимосвязи.

#### Задание 7.3

Выберите подходящий статистический тест для проверки гипотезы из п. 7.1 и объясните свой выбор.

Вес и рос являются количественными непрерывными переменными с визуально нормальным распределением. Взаимосвясь признака визуально линейная, но есть аномальные значения, однако выборка достаточно большая, аномальных значений относительно не много. С целью проверки гипотезы об отсутсвии взаимосвязи можем применить коэффицент корреляции Пирсона.

Используя выбранный тест, проверьте гипотезы из п. 7.1 на уровне значимости α = 0.05.

```{r}
#тест по умолчанию использует уровень значимости 0,05
cor.test(nhanes_clean$Height, nhanes_clean$Weight)
```

Оцените величину наблюдаемого эффекта.

Коэффицент корреляции Пирсона равен 0.45, что говорит нам о умеренной положительной корреляции веса и роста пациентов.

#### Задание 7.4

Как p-значение и 95% доверительный интервал информируют вас о силе и направлении связи между ростом и весом? Что вы можете сказать про статистическую и практическую значимость результата?

Полученное p-значение меньше 0.05, что дает нам возможность опровергнуть нулевую гипотезу об отсутствии взаимосвязи между переменными роста и веса. Узкий 95% ДИ [0.43 - 0.47] коэффицента корреляции не включает 0. Т.к. ДИ находится в области положительных значений и коэффицент корреляции равен 0.45, мы можем говорить о наличии положительной статистически значимой корреляции между ростом и весом.

ТАКИМ ОБРАЗОМ:
На основаннии коэффицента корреляции Пирсона обнаружена статистически значимая взаимосвязь роста и веса по уровню значимости 0.05 (p = 2.2e-16), коээфицент равен 0.45, 95% ДИ [0.43, 0.47].

Практическая значимость результата предполагает ожидание бОльшей массы тела у пациентов с бОльшим ростом (направление взаимосвязи мы не знаем), однако, судя по небольшому значению коээфицента, на обнаруженную взаимосвять влияние оказывают также другие факторы.

### 8. Анализ зависимости между образованием и доходом

Вопрос. Существует ли связь между уровнем образования (Education) и доходом домохозяйства (HHIncome) у участников NHANES старше 18 лет?

#### Задание 8.1 + ИЗМЕНЕНИЯ

Ваш комментарий:
Нул. гипотеза для корреляции Спирмена: “Связи между уровнем образования и
доходом домохозяйства у участников NHANES старше 18 лет нет.” - звучит также как
гипотеза для теста хи-квадрат, не хватает всего одного слова

Сформулируйте нулевую и альтернативную гипотезы.

-   $H_0$: <u>Монотонной связи</u> между уровнем образования и доходом домохозяйства у участников NHANES старше 18 лет нет.
-   $H_a$: <u>Монотонная связь</u> между уровнем образования и доходом домохозяйства у участников NHANES старше 18 лет есть.

Рассмотрим распределения признаков

```{r fig.width=13, fig.height=5}
edbar <- nhanes_clean_mine %>% 
  ggplot() +
  geom_bar(aes(y = Education), fill = 'seagreen', colour = 'black')+
  labs(
    title = 'Распределение числа пациентов по уровню образования',
    x = 'Количество пациентов',
    y = 'Уровень образования'
  )+
  scale_x_continuous(breaks = seq(0,2000,250))+
  theme(
    plot.title = element_text(size = 16.5, hjust = 1),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12)
  )

hhibar <- nhanes_clean_mine %>% 
  ggplot() +
  geom_bar(aes(y = HHIncome), fill = 'sienna3', colour = 'black')+
  labs(
    title = 'Распределение числа пациентов по уровню дохода',
    x = 'Количество пациентов',
    y = 'Уровень дохода (в долларах США)'
  )+
  scale_x_continuous(breaks = seq(0,1500,250))+
  theme(
    plot.title = element_text(size = 16.5, hjust = 1),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12)
  )

edbar|hhibar
```

Большинство учатников исследования закончило коллежд и имеют высокий уровень дохода. И наоборот наименьшая часть окончило только 8 классов и иммеет низких или нулевой уровень дохода.

#### Задание 8.2

Постройте диаграмму рассеяния, которая позволит визуализировать связь между изучаемыми переменными.

```{r}
nhanes_clean_mine %>% 
  ggplot(aes(x = Education, y = HHIncome))+
  geom_count()+
  labs(
    title = 'Взаимосвязь уровня дохода и образования пациентов',
    x = 'Уровень образования',
    y = 'Уровень дохода (в долларах США)'
  )
```

Из графика видно, что с повышением уровня образования растет количество людей с максимальным по нашей шкале доходом. Люди, закончившие среднюю школу имеют примерно равное распределение числа пациентов относительно всех уровней дохода.

#### Задание 8.3

Выберите подходящий статистический тест для проверки гипотезы из п. 8.1 и объясните свой выбор.

Мы хотим проверить наличие взаимосвязь между двумя порядковыми переменными для этого можем использовать коэффицент корреляции Спирмена.


Используя выбранный тест, проверьте гипотезы из п. 8.1 на уровне значимости α = 0.05.

```{r}
#Тест по умолчанию использует уровень значимости 0,05
cor.test(as.numeric(nhanes_clean$Education), as.numeric(nhanes_clean$HHIncome), method = "spearman")

```

Оцените величину наблюдаемого эффекта.
Коэффицент корреляции спирмена равный 0,44 говрит об умеренной положительной взаимосвязи уровня дохода и уровня образования пациентов.


#### Задание 8.4

Как p-значение и значение коэффициента корреляции информируют вас о силе и направлении связи между уровнем образования и доходом домохозяйства? Что вы можете сказать про статистическую и практическую значимость результата?

Полученное p-значение меньше 0.05, что дает нам возможность опровергнуть нулевую гипотезу об отсутствии взаимосвязи между переменными уровня образования и дохода. Т.к. значение коэффицента находится в области положительных значений и равен 0.45, мы можем говорить о наличии положительной статистически значимой корреляции между уровнем дохода и уровнем образвоани.

ТАКИМ ОБРАЗОМ:
На основаннии коэффицента корреляции Спирмена обнаружена статистически значимая взаимосвязь роста и веса по уровню значимости 0.05 (p = 2.2e-16), коээфицент равен 0.44.

Практическая значимость результата предполагает ожидание бОльшего уровня дохода при бОльшем уровне образования (о направдении связи мы утверждать не можем), судя по небольшому значению коээфицента, на обнаруженную взаимосвять влияние оказывают также другие факторы.
